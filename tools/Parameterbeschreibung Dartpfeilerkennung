
ğŸ”¬ Parameter-ErklÃ¤rung im Detail
ğŸ¨ Shape constraints (Grundfilter)
Parameter	Bedeutung	Physikalischer Einfluss
min_area / max_area	minimale und maximale Pixel-FlÃ¤che der Kontur	Verhindert, dass winzige Rauschpunkte oder ganze Handbewegungen als Pfeil gelten. Bei 1080p â‰ˆ 10â€“1000 pxÂ² ist typisch. Wenn dein Pfeil weiter entfernt ist, erhÃ¶he max_area (z. B. 1500â€“2000).
min_aspect_ratio / max_aspect_ratio	VerhÃ¤ltnis Breite/HÃ¶he der Bounding-Box	Ein Dart hat meist eine lÃ¤ngliche Silhouette, etwa 1:3â€“1:5, wenn man ihn seitlich sieht. Zu niedriger Wert â†’ zu rund; zu hoher â†’ zu langer Strich (z. B. Schatten). Bei dir ideal: 0.3â€“3.0.Sehr gute Frage â€” das ist genau der Kern, um zu verstehen, **warum dein Dart-Impact-System â€zu vielâ€œ oder â€zu wenigâ€œ erkennt** ğŸ¯

Ich erklÃ¤r dir jeden Parameter **nicht nur wÃ¶rtlich**, sondern **mit physischem Bezug** auf das, was im Frame passiert â€” also, *wie OpenCV durch die Maske und Konturen letztlich â€Pfeileâ€œ erkennt.*

---

## ğŸ§© Kontext

Der `DartImpactDetector` arbeitet typischerweise so:

1. Er bekommt eine **Motion Mask** (Differenz oder MOG2-Ausgabe).
2. Findet darin **Konturen (cv2.findContours)**.
3. Berechnet pro Kontur geometrische Kennwerte wie:

   * FlÃ¤che, Umfang â†’ `area`, `perimeter`
   * Begrenzungsrechteck â†’ `aspect_ratio`
   * KonvexitÃ¤t â†’ `solidity`
   * Bounding Box / FlÃ¤che â†’ `extent`
   * Kantenanteil â†’ `edge_density`
4. Filtert mit diesen Parametern, bewertet Kandidaten, und meldet einen Treffer, wenn mehrere Frames hintereinander konsistent dasselbe Objekt zeigen (â†’ `confirmation_frames`).

---

## ğŸ”¬ Parameter-ErklÃ¤rung im Detail

### ğŸ¨ **Shape constraints (Grundfilter)**

| Parameter                               | Bedeutung                                     | Physikalischer Einfluss                                                                                                                                                                                |
| --------------------------------------- | --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `min_area` / `max_area`                 | minimale und maximale Pixel-FlÃ¤che der Kontur | Verhindert, dass winzige Rauschpunkte oder ganze Handbewegungen als Pfeil gelten.  Bei 1080p â‰ˆ 10â€“1000 pxÂ² ist typisch.  Wenn dein Pfeil weiter entfernt ist, **erhÃ¶he** `max_area` (z. B. 1500â€“2000). |
| `min_aspect_ratio` / `max_aspect_ratio` | VerhÃ¤ltnis Breite/HÃ¶he der Bounding-Box       | Ein Dart hat meist eine lÃ¤ngliche Silhouette, etwa 1:3â€“1:5, wenn man ihn seitlich sieht.  Zu niedriger Wert â†’ zu rund; zu hoher â†’ zu langer Strich (z. B. Schatten).  Bei dir ideal: 0.3â€“3.0.          |

ğŸ‘‰ Diese Filter greifen **ganz am Anfang**: nur was zwischen diesen Grenzen liegt, wird Ã¼berhaupt weiter bewertet.

---

### ğŸ§® **Advanced shape heuristics**

| Parameter                               | Beschreibung                                        | Wirkung                                                                                                                              |
| --------------------------------------- | --------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| `min_solidity` / `max_solidity`         | VerhÃ¤ltnis **(KonturflÃ¤che / konvexe HÃ¼lle)**       | â€Wie geschlossenâ€œ ist die Form? Ein echter Pfeil hat LÃ¼cken (Schaft + Spitze), daher 0.1â€“0.95 erlaubt ein bisschen UnregelmÃ¤ÃŸigkeit. |
| `min_extent` / `max_extent`             | VerhÃ¤ltnis **(KonturflÃ¤che / Bounding-Box-FlÃ¤che)** | Ein MaÃŸ fÃ¼r â€FÃ¼llgradâ€œ. Eine kompakte Form (z. B. Dartkopf) hat hohen Extent, ein schlanker Pfeil niedrigen.                         |
| `min_edge_density` / `max_edge_density` | Prozentsatz von Kantenpixeln im ROI (aus Canny).    | Zu niedrige Werte = glatte FlÃ¤chen (Hintergrund), zu hohe = stark texturierte Bereiche (z. B. Board).  Typisch: 0.02â€“0.35.           |
| `preferred_aspect_ratio`                | Erwartetes VerhÃ¤ltnis Breite/HÃ¶he eines Pfeils      | z. B. 0.35 bedeutet: Objekt etwa 3Ã— so lang wie breit. Wird zur â€Scoreâ€œ-Berechnung herangezogen.                                     |
| `aspect_ratio_tolerance`                | Wie tolerant das System gegenÃ¼ber Abweichungen ist  | Bei 1.5 werden Formabweichungen Â±50 % noch akzeptiert. HÃ¶her = tolerant, aber fehleranfÃ¤lliger.                                      |

ğŸ‘‰ Diese Gruppe bestimmt, **wie â€dart-artigâ€œ eine Form aussieht.**
Wenn du viele Fehlalarme (z. B. Board-Texturen oder Schatten) bekommst â†’ enger machen.
Wenn er keine Pfeile mehr findet â†’ toleranter (Werte erhÃ¶hen).

---

### âš¡ **Edge detection**

| Parameter                                        | Beschreibung                 | Wirkung                                                                                                                                                                                    |
| ------------------------------------------------ | ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `edge_canny_threshold1`, `edge_canny_threshold2` | Schwellwerte fÃ¼r `cv2.Canny` | Zu niedrig â†’ zu viele falsche Kanten, zu hoch â†’ keine erkennbaren Pfeile.  Wenn du hell beleuchtet filmst, erhÃ¶he beide (z. B. 60/180).  Wenn du wenig Kontrast hast, senke (z. B. 30/90). |

ğŸ‘‰ Der â€Edge-Densityâ€œ-Wert basiert auf dieser Canny-Kante. Also direkt relevant.

---

### ğŸ¯ **Confidence weighting**

| Parameter             | Beschreibung                                 | Wirkung                                                        |
| --------------------- | -------------------------------------------- | -------------------------------------------------------------- |
| `circularity_weight`  | Wie wichtig ist â€rund seinâ€œ (z. B. Dartkopf) | 0.35 â†’ moderat wichtig; zu hoch = erkennt eher runde Objekte.  |
| `solidity_weight`     | Gewicht fÃ¼r â€geschlossenheitâ€œ                | 0.2 â†’ glatte vs. zerfranste Formen.                            |
| `extent_weight`       | Gewicht fÃ¼r FÃ¼llgrad                         | 0.15 â†’ kontrolliert, wie dicht das Objekt in seiner Box liegt. |
| `edge_weight`         | Gewicht fÃ¼r Kantenanteil                     | 0.15 â†’ bevorzugt Objekte mit sauberem Umriss.                  |
| `aspect_ratio_weight` | Gewicht fÃ¼r SeitenverhÃ¤ltnis                 | 0.15 â†’ stÃ¤rkt typische Dart-Silhouetten.                       |

ğŸ‘‰ Der Detektor kombiniert diese Werte zu einem **Score zwischen 0â€“1** und akzeptiert Kandidaten mit `score > threshold` (implizit in deinem Code).
Du kannst damit das **â€Profilâ€œ des Dart-Treffers** anpassen:

* LÃ¤nglicher Dart â†’ erhÃ¶he `aspect_ratio_weight`
* Deutlicher Rand â†’ erhÃ¶he `edge_weight`
* Runde Spitze â†’ erhÃ¶he `circularity_weight`

---

### â±ï¸ **Temporal confirmation**

| Parameter               | Beschreibung                                                        | Wirkung                                                                                                                              |
| ----------------------- | ------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| `confirmation_frames`   | wie viele aufeinanderfolgende Frames dieselbe Position haben mÃ¼ssen | DÃ¤mpft Rauschen â†’ stabilere Erkennung, aber mehr Latenz.  Bei 3 Frames â‰ˆ 0.1 s bei 30 fps.                                           |
| `position_tolerance_px` | erlaubte Bewegung pro Frame                                         | Bei 20 px ist ein leichter Sprung erlaubt. Zu klein â†’ Erkennung bricht ab bei kleinsten Bewegungen; zu groÃŸ â†’ Rauschen addiert sich. |

ğŸ‘‰ Das ist dein **â€Anti-Flacker-Systemâ€œ**: verhindert, dass ein Wackeln sofort als neuer Treffer gilt.

---

### ğŸ§Š **Cooldown (neu, wichtig)**

| Parameter            | Beschreibung                                                                  | Wirkung                                                                                            |
| -------------------- | ----------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------- |
| `cooldown_frames`    | Wie lange nach einem Treffer die Umgebung ignoriert wird                      | Verhindert Doppel-Erkennungen, wenn der Pfeil noch im Flug sichtbar ist. Typisch: 30 Frames â‰ˆ 1 s. |
| `cooldown_radius_px` | Radius um letzte Trefferposition, in dem wÃ¤hrend Cooldown nichts erkannt wird | Verhindert mehrfaches ZÃ¤hlen desselben Pfeils. Typisch: 30â€“60 px.                                  |

---

### ğŸ“œ **History & Motion mask**

| Parameter                      | Beschreibung                                | Wirkung                                                                                                                                                                                |
| ------------------------------ | ------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `candidate_history_size`       | Wie viele Kandidaten gespeichert werden     | Dient zur GlÃ¤ttung und Wiedererkennung. GrÃ¶ÃŸer = stabiler, aber trÃ¤ger.                                                                                                                |
| `motion_mask_smoothing_kernel` | GrÃ¶ÃŸe des GlÃ¤ttungsfilters (z. B. 5 Ã— 5 px) | Entfernt kleine LÃ¼cken in der Bewegungsmaske.  Wenn du viel Rauschen hast (z. B. LED-Flimmern), **erhÃ¶he** auf 7 oder 9.  Wenn du schnelle, kleine Darts hast, **senke** auf 3 oder 0. |

---

## ğŸ§  Zusammengefasst

| Gruppe                  | Was sie steuert      | PrimÃ¤re Effekte                                   |
| ----------------------- | -------------------- | ------------------------------------------------- |
| **Shape constraints**   | absolute Filterung   | entscheidet, ob Ã¼berhaupt weiter geprÃ¼ft wird     |
| **Advanced heuristics** | Form-â€DNAâ€œ des Darts | Feintuning zwischen echten Pfeilen und Artefakten |
| **Edge detection**      | KantensensitivitÃ¤t   | beeinflusst Edge-Density-MaÃŸ direkt               |
| **Confidence weights**  | Kombination zu Score | Balance der Einflussfaktoren                      |
| **Temporal**            | StabilitÃ¤t Ã¼ber Zeit | verhindert Flackern                               |
| **Cooldown**            | Anti-Doppel-Trigger  | unterdrÃ¼ckt MehrfachzÃ¤hlungen                     |
| **Mask smoothing**      | Rauschfilter         | glÃ¤ttet Bewegungsmaske vor Konturerkennung        |

---

## ğŸ§­ Praxis-Tuning-Tipps

| Ziel                        | Ã„nderung                                                                         |
| --------------------------- | -------------------------------------------------------------------------------- |
| erkennt nichts â†’ zu streng  | `min_area â†“`, `max_area â†‘`, `min_solidity â†“`, `confirmation_frames â†“`            |
| viele Fehlalarme            | `min_extent â†‘`, `max_extent â†“`, `edge_canny_threshold1/2 â†‘`, `cooldown_frames â†‘` |
| DoppelzÃ¤hlungen             | `cooldown_radius_px â†‘`, `confirmation_frames â†‘`                                  |
| Pfeile nicht stabil erkannt | `position_tolerance_px â†‘`, `candidate_history_size â†‘`                            |
| zu empfindlich auf Licht    | `motion_mask_smoothing_kernel â†‘`, `edge_thresholds â†‘`                            |

---
